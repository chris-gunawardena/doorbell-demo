!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){!function(t){"use strict";var e=function(){this.events={}};e.prototype={on:function(t,e){var i=this;return(t=this.events[t]=this.events[t]||[]).push(e),function(){return i.off(t,e)}},off:function(t,e){(t=this.events[t]=this.events[t]||[]).splice(t.indexOf(e)>>>0,1)},emit:function(t){var e=this,i=this.events[t];if(i&&i[0]){var n=i.slice.call(arguments,1);i.slice().map(function(t){return t.apply(e,n)})}}};var i=[["lorem","ipsum","dolor","sit","amet"],["fo^$*@!#x","jum[.,]ps","ov#$^er","bri;24dge","dea=-=th"],["fancy","planes","foolish","man","juice"],["nunc","vehicula","lectus","fermentum","suscipit"],["adipiscing","erat","porta","lobortis","ullamcorper"],["lorem","ipsum","dolor","sit","amet"],["fo^$*@!#x","jum[.,]ps","ov#$^er","bri;24dge","dea=-=th"],["fancy","planes","foolish","man","juice"],["nunc","vehicula","lectus","fermentum","suscipit"],["adipiscing","erat","porta","lobortis","ullamcorper"]],n={default:{colors:{accent:"#ae64cd",primary:"#ffffff",bg:"#2c3e50"},dimens:{line_width:6,node_radius:20,node_core:8,node_ring:1}},success:{colors:{accent:"#51e980"}},failure:{colors:{accent:"#e74c3c"}}},o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(t,e,i){return e.forEach(function(e){return t.addEventListener(e,i,{passive:!1})})},a=requestAnimationFrame,c=function(t){return new Error("Invalid or empty "+t+" passed")},h={PATTERN_COMPLETE:"complete",PATTERN_START:"start"},u={theme:"default",grid:[3,3],width:300,height:430},l=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e.$canvas)throw c("$canvas");e=o({},u,e),this.$canvas=e.$canvas,this.dimens={width:e.width,height:e.height},this.$canvas.width=this.dimens.width,this.$canvas.height=this.dimens.height,this.ctx=this.$canvas.getContext("2d"),this.initialize(e)}return r(t,[{key:"initialize",value:function(t){this._onTouchStart=this._onTouchStart.bind(this),this._onTouchStop=this._onTouchStop.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onResize=this._onResize.bind(this),this.renderLoop=this.renderLoop.bind(this),this.calculationLoop=this.calculationLoop.bind(this),this.initializeEventBus(),this.setTheme(t.theme),this._onResize(),this.setInitialState(),this.generateGrid.apply(this,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(t.grid)),this.attachEventHandlers()}},{key:"setTheme",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=n.default;if("string"==typeof t&&(t=n[t]),!t)throw c("theme");return this.THEME=this.THEME||{},this.THEME.colors=o({},i.colors,t.colors),this.THEME.dimens=o({},i.dimens,t.dimens),e&&this.forceUpdate(),this.THEME}},{key:"attachEventHandlers",value:function(){s(this.$canvas,["mousedown","touchstart"],this._onTouchStart),s(this.$canvas,["mouseup","touchend"],this._onTouchStop),s(window,["mousemove","touchmove"],this._onTouchMove),s(window,["resize"],this._onResize),a(this.renderLoop),a(this.calculationLoop)}},{key:"initializeEventBus",value:function(){this.eventBus=new e}},{key:"on",value:function(t,e){return this.eventBus.on(t,e)}},{key:"off",value:function(t,e){return this.eventBus.off(t,e)}},{key:"emit",value:function(t){for(var e,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return(e=this.eventBus).emit.apply(e,[t].concat(n))}},{key:"onStart",value:function(t){return this.on(h.PATTERN_START,t),this}},{key:"onComplete",value:function(t){return this.on(h.PATTERN_COMPLETE,t),this}},{key:"setInitialState",value:function(){this.coordinates=null,this.selectedNodes=[],this.lastSelectedNode=null}},{key:"onPatternStart",value:function(){this.emit(h.PATTERN_START,{})}},{key:"onPatternComplete",value:function(){var t=this.selectedNodes.slice(0),e=function(t){return t.reduce(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1];return i[e.row-1][e.col-1]+t})}(t),n=function(t){if(!t.length)return"";var e=t.split("").reduce(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1];return(t=(t<<5)-t+e.charCodeAt(0))&t});return btoa(e+"")}(e);this.emit(h.PATTERN_COMPLETE,{nodes:t,hash:n,password:e})}},{key:"_onResize",value:function(){this.bounds=this.$canvas.getBoundingClientRect()}},{key:"_onTouchStart",value:function(t){t&&t.preventDefault(),this.setInitialState(),this.calculationLoop(!1),this.renderLoop(!1),this.onPatternStart(),this._isDragging=!0}},{key:"_onTouchStop",value:function(t){t&&t.preventDefault(),this.coordinates=null,this.renderLoop(!1),this.onPatternComplete(),this._isDragging=!1}},{key:"_onTouchMove",value:function(t){if(t&&t.preventDefault(),this._isDragging){var e={x:t.pageX||t.touches[0].pageX,y:t.pageY||t.touches[0].pageY};e.x-=this.bounds.left,e.y-=this.bounds.top,e.x<=this.dimens.width&&e.x>0&&e.y<=this.dimens.height&&e.y>0?this.coordinates=e:this._onTouchStop()}}},{key:"isSelected",value:function(t){return!!this.selectedNodes.find(function(e){return e.row==t.row&&e.col==t.col})}},{key:"addIntermediaryNodes",value:function(t){var e=this.intermediaryNodesStep(t);if(0!==e.row||0!==e.col)for(var i={row:this.lastSelectedNode.row+e.row,col:this.lastSelectedNode.col+e.col},n=Math.max(this.rows,this.cols),o=0;o++<n&&(i.row!==t.row||i.col!==t.col);)this.selectedNodes.push(i),i={row:i.row+e.row,col:i.col+e.col};this.lastSelectedNode=t}},{key:"intermediaryNodesStep",value:function(t){var e={row:0,col:0};if(!this.lastSelectedNode)return e;var i=Math.abs(this.lastSelectedNode.row-t.row),n=Math.abs(this.lastSelectedNode.col-t.col);if(1===i||1===n)return e;var o=this.lastSelectedNode.row-t.row<0?1:-1,r=this.lastSelectedNode.col-t.col<0?1:-1;if(0===i)0!==n&&(e.col=r);else if(0===n)e.row=o;else{var s=Math.max(i,n),a=Math.min(i,n),c=function(t,e){for(;0!=e;){var i=t;t=e,e=i%e}return t}(s,a);s%a==0&&(e.col=n/c*r,e.row=i/c*o)}return e}},{key:"calculationLoop",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDragging&&this.coordinates&&this.forEachNode(function(e,i){var n=Math.sqrt(Math.pow(t.coordinates.x-e,2)+Math.pow(t.coordinates.y-i,2));if(n<t.THEME.dimens.node_radius+1){var o=e/t.interval.x,r=i/t.interval.y,s={row:o,col:r};if(!t.isSelected(s))return t.addIntermediaryNodes(s),t.selectedNodes.push(s),!1}}),e&&a(this.calculationLoop)}},{key:"forceUpdate",value:function(){var t=this;a(function(){var e=t._isDragging;t._isDragging=!0,t.calculationLoop(!1),a(function(){t.renderLoop(!1),t._isDragging=e})})}},{key:"renderLoop",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDragging){var i=this.THEME.colors,n=i.accent,o=i.primary;this.ctx.clearRect(0,0,this.dimens.width,this.dimens.height),this.renderGrid();var r=this.selectedNodes.reduce(function(e,i){if(e){var r={x:i.row*t.interval.x,y:i.col*t.interval.y},s={x:e.row*t.interval.x,y:e.col*t.interval.y};t.drawNode(r.x,r.y,n,o,t.THEME.dimens.node_ring+3),t.drawNode(s.x,s.y,n,o,t.THEME.dimens.node_ring+3),t.joinNodes(e.row,e.col,i.row,i.col)}return i},null);r&&this.coordinates&&(this.drawNode(r.row*this.interval.x,r.col*this.interval.y,n,o,this.THEME.dimens.node_ring+6),this.joinNodes(r.row*this.interval.x,r.col*this.interval.y,this.coordinates.x,this.coordinates.y,!0))}e&&a(this.renderLoop)}},{key:"generateGrid",value:function(t,e){this.rows=t,this.cols=e,this.renderGrid()}},{key:"renderGrid",value:function(){this.ctx.fillStyle=this.THEME.colors.bg,this.ctx.fillRect(0,0,this.dimens.width,this.dimens.height),this.interval={x:this.dimens.width/(this.rows+1),y:this.dimens.height/(this.cols+1)},this.forEachNode(this.drawNode.bind(this))}},{key:"forEachNode",value:function(t){var e=this,i=Array(this.rows).fill(this.interval.x),n=Array(this.cols).fill(this.interval.y),o=new Error("Break Exception");try{n.reduce(function(n,r){return i.reduce(function(e,i){if(!1===t(e,n))throw o;return e+i},e.interval.x),n+r},this.interval.y)}catch(t){if(t!==o)throw t}}},{key:"drawNode",value:function(t,e,i,n,o){this.ctx.lineWidth=o||this.THEME.dimens.node_ring,this.ctx.fillStyle=i||this.THEME.colors.primary,this.ctx.strokeStyle=n||this.THEME.colors.primary,this.ctx.beginPath(),this.ctx.arc(t,e,this.THEME.dimens.node_core,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t,e,this.THEME.dimens.node_radius,0,2*Math.PI),this.ctx.stroke()}},{key:"joinNodes",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=this.interval;o&&(r={x:1,y:1});var s={x:r.x*t,y:r.y*e},a={x:r.x*i,y:r.y*n};this.ctx.lineWidth=this.THEME.dimens.line_width,this.ctx.strokeStyle=this.THEME.colors.accent,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(a.x,a.y),this.ctx.stroke()}},{key:"match",value:function(t,e){var i=function(t){var e=function(){},i=function(){},n={check:function(n){return-1!==t.indexOf(n)?e():i()},onSuccess:function(t){return e=t,n},onFailure:function(t){return i=t,n}};return n}(e);return this.on(h.PATTERN_COMPLETE,function(e){return i.check(e[t])}),i}},{key:"matchHash",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.match("hash",e)}},{key:"matchPassword",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.match("password",e)}}]),t}();t.PatternLock=l,t.default=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(l,[null].concat(e)))},Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,i){"use strict";i.r(e);var n=i(0);const o=i.n(n)()({$canvas:document.querySelector("#patternLock"),width:300,height:430,grid:[3,3]}).onComplete(async({hash:t})=>{o.setTheme("default");let e=await fetch("/api/unlock",{method:"post",body:JSON.stringify({deviceId:"esp8266_23F44B",key:t})});o.setTheme(e.ok?"success":"failure")})}]);